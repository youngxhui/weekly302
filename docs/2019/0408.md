# 04 月 08 日 第三周

## 本周要闻

## 开源项目

## 优秀文章

## 小记

### 小程序快速开发：解耦云数据与页面数据  

使用对小程序的快速开发时，对页面的操作和云端数据逻辑操作耦合在一起，无论是阅读或者维护代码都会有一定的困难。

如果将将它们解耦，势必会舒服很多。  

如果不解耦的话，小程序的代码是这样的：

```
// login.js
login: function() {

  const that = this
  
  let query = new wx.BaaS.Query()
  
  query.compare('id', '>=', 12345)
  query.compare('pwd', '<', 12345)
  
  let tableName = 'test'
  let Product = new wx.BaaS.TableObject(tableName)

  Product.setQuery(query).then(res => {
    // success 

  }, err => {
    // err

  })

}
```

不难看出，除了进行数据表和数据项的设置，剩下的对数据和页面逻辑的操作都要写在 res => {} 之中

正巧有一个机会重新使用了快速开发，我通过这种方式解耦的：

```
// app.js
config: {
  clientID: "test\test\test\test\",
  table: {
    user: {
      name: "user",
      id: "test\test\test\test\"
    }
  }
},

login: function(recordID, successCallback, failCallback) {

  const that = this
  
  let Product = new wx.BaaS.TableObject(that.config.table.user.name)
  
  query.compare('id', '>=', 12345)
  query.compare('pwd', '<', 12345)
  
  Product.setQuery(recordID).then(res => {
    // success 
    // 页面处理的函数由页面负责
    successCallback(res)
  }, err => {
    // err
    failCallback(res)
  })

}
```

app.js 中进行了封装，那么在页面处理起来就非常简单了，同时，无论是 SDK 升级还是后期维护代码可读性都有一定的增强。

```
// login.js
login: function() {

  const that = this
  query
  app.loginService(that.data.recordID, res => {
  // success 
  
  }, err=>{})
  
}
```

### 使用后注解来美化 Java：Controller 和 实体类

对 Controller 美化的原则很简单了，将逻辑写在 Service 中并返回一个对象即可，Controller 中进行风格的同一就好了。

实例：

```java
@RestController
@CrossOrigin
@RequestMapping("/user")
public class UserController {

    @Autowired
    private UserService userService;

    @RequestMapping(value = "/login", method = RequestMethod.POST)
    public Result loggin(@RequestBody User user) {
        return new Result(StatusCode.OK, GET_OK_MESSAGE, userService.login(user));
    }

    @RequestMapping(value = "/{id}", method = RequestMethod.GET)
    public Result findById(@PathVariable("id") String id) {
        return new Result(StatusCode.OK, GET_OK_MESSAGE, userService.findById(id));
    }

    @RequestMapping(method = RequestMethod.POST)
    public Result save(@RequestBody User user) {
        return new Result(StatusCode.OK, POST_OK_MESSAGE, userService.save(user));
    }

    @RequestMapping(value = "/{id}", method = RequestMethod.PUT)
    public Result update(@PathVariable("id") String id, @RequestBody User user) {
        return new Result(StatusCode.OK, PUT_OK_MESSAGE, userService.update(user));
    }

    @RequestMapping(value = "/{id}", method = RequestMethod.DELETE)
    public Result deleteById(@PathVariable("id") String id) {
        return new Result(StatusCode.OK, DELETE_OK_MESSAGE, userService.deleteById(id));
    }

    @RequestMapping(value = "/search/{page}/{size}", method = RequestMethod.POST)
    public Result findAll(@RequestBody User user, @PathVariable Integer pageNumber, @PathVariable Integer pageSize) {
        return new Result(StatusCode.OK, GET_OK_MESSAGE, userService.findAll(user, pageNumber, pageSize));
    }

}
```

lombok 美化实体类

https://projectlombok.org/

实例：

```java
@Entity
@Setter
@Getter
public class User implements Serializable {

    @Id
    private String id;

    private String username;

    private String name;

    @Column(nullable = false)
    private String password;

}
```

## 工具

